<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Order History</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font import */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        /* Custom styles for the status badges */
        .status-Pending { @apply bg-yellow-100 text-yellow-800; }
        .status-Shipped { @apply bg-blue-100 text-blue-800; }
        .status-Delivered { @apply bg-green-100 text-green-800; }
        .status-Cancelled { @apply bg-red-100 text-red-800; }
    </style>
    <script>
        // Tailwind configuration for custom colors
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#1e293b',
                        'accent-sky': '#0ea5e9',
                        'accent-hover': '#0284c7',
                    }
                }
            }
        }
    </script>
</head>
<body class="text-slate-900 flex flex-col min-h-screen">

<!-- Header & Navigation (Dark Theme) -->
<header th:replace="fragments/header :: header"></header>

<!-- Main Content Area -->
<main class="flex-grow">
    <div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8 mt-6">
        <h1 class="text-4xl font-extrabold text-slate-900 mb-10 border-b pb-3">Your Order History</h1>

        <!-- EMPTY STATE -->
        <div th:if="${#lists.isEmpty(orders)}" class="bg-white p-12 rounded-xl shadow-lg border border-gray-200 text-center">
            <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
            <p class="text-xl text-gray-600 font-semibold">You haven't placed any orders yet.</p>
            <p class="text-gray-500 mt-2">All your future orders will appear here after you proceed to checkout.</p>
            <div class="mt-6">
                <a href="/products" class="inline-flex items-center px-6 py-3 border border-transparent text-sm font-medium rounded-lg shadow-md text-white bg-accent-sky hover:bg-accent-hover transition duration-300">
                    Continue Shopping
                </a>
            </div>
        </div>

        <!-- ORDER HISTORY LOOP -->
        <div th:unless="${#lists.isEmpty(orders)}" class="space-y-6">
            <div th:each="order : ${orders}"
                 class="bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300 overflow-hidden border border-gray-100">

                <!-- Order Summary Header (Always Visible) -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center p-5 cursor-pointer"
                     th:onclick="|toggleDetails('order-details-${order.id}', this)|">

                    <!-- Left: ID, Date, Status -->
                    <div class="space-y-2 md:space-y-0 md:flex md:space-x-8">
                        <div>
                            <p class="text-xs font-semibold uppercase text-gray-500">Order ID</p>
                            <p class="font-bold text-sm text-sky-700" th:text="${order.id}">#1001</p>
                        </div>
                        <div>
                            <p class="text-xs font-semibold uppercase text-gray-500">Order Date</p>
                            <p class="font-medium text-sm" th:text="${#temporals.format(order.orderDate, 'MMM dd, yyyy')}">Jan 01, 2024</p>
                        </div>
                        <div>
                            <p class="text-xs font-semibold uppercase text-gray-500">Status</p>
                            <!-- Dynamically apply status class based on the 'status' property -->
                            <span class="px-3 py-1 text-xs font-semibold rounded-full capitalize"
                                  th:classappend="|status-${order.status}|"
                                  th:text="${order.status}">Pending</span>
                        </div>
                    </div>

                    <!-- Right: Total and Toggle Button -->
                    <div class="flex items-center space-x-4 mt-4 md:mt-0">
                        <div>
                            <p class="text-xs font-semibold uppercase text-gray-500 text-right">Order Total</p>
                            <p class="text-xl font-extrabold text-green-700 text-right">
                                <span th:text="'₹' + ${#numbers.formatDecimal(order.total, 0, 2)}">₹500.00</span>
                            </p>
                        </div>
                        <button type="button" class="toggle-btn text-gray-500 hover:text-sky-600 transition p-2 rounded-full">
                            <!-- Chevron Down Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Order Details (Collapsible Section) -->
                <div th:id="|order-details-${order.id}|" class="hidden border-t bg-gray-50">
                    <div class="p-5">
                        <h4 class="font-bold text-lg mb-4 text-slate-700">Items Ordered:</h4>

                        <!-- Items List -->
                        <div class="space-y-3">
                            <div th:each="item : ${order.orderItems}" class="flex justify-between items-center py-2 border-b border-gray-200 last:border-b-0">
                                <div class="flex items-center space-x-4">
                                    <!-- Product Image Placeholder -->
                                    <div class="w-10 h-10 flex items-center justify-center bg-white rounded-md border overflow-hidden">
                                        <img th:src="${item.product.imageUrl}"
                                             alt="Product"
                                             class="w-full h-full object-contain"
                                             onerror="this.onerror=null;this.src='https://placehold.co/40x40?text=P';">
                                    </div>
                                    <span class="font-medium" th:text="${item.product.name}">Product Name</span>
                                </div>
                                <div class="text-right flex space-x-6 text-sm">
                                    <span class="text-gray-600">Qty: <strong th:text="${item.quantity}">1</strong></span>
                                    <span class="font-semibold text-slate-800">
                                        Unit Price: <span th:text="'₹' + ${#numbers.formatDecimal(item.price, 0, 2)}">₹100.00</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Footer (Dark Theme) -->
<footer th:replace="fragments/footer :: footer"></footer>

<script>
    function toggleDetails(id, summaryElement) {
        const detailsDiv = document.getElementById(id);
        const toggleBtn = summaryElement.querySelector('.toggle-btn svg');

        if (detailsDiv.classList.contains('hidden')) {
            // Show details
            detailsDiv.classList.remove('hidden');
            toggleBtn.classList.add('rotate-180');
        } else {
            // Hide details
            detailsDiv.classList.add('hidden');
            toggleBtn.classList.remove('rotate-180');
        }
    }
</script>

</body>
</html>
